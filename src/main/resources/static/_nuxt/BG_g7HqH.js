import{d as D,o as A,x as r,y as a,I as m,J as F,z as e,D as S,K as N,L as C,M as x,A as j,g as d,N as M,k as v,_ as H,O as V}from"./CorKVTLH.js";const G={class:"feedback-widget-container"},P={class:"feedback-popup swing-in-bottom-fwd"},$={class:"popup-body"},J={class:"form-group"},W={class:"form-group"},q={class:"input-wrapper"},K={key:0,class:"error-text"},Q={class:"status-content"},Y={key:0,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},X={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Z=["disabled"],ee={key:0,class:"spinner"},te={key:1},oe={class:"icon-wrapper"},O="servicelinklite_feedback",R="servicelinklite_feedback_last",ne=3e3,se=D({__name:"FeedbackWidget.ce",props:{apiBase:{type:String,default:""}},setup(h){const l={SUCCESS:"SUCCESS",FAILED:"FAILED",TOO_FREQUENT:"TOO_FREQUENT",CHANNEL_DISABLED:"CHANNEL_DISABLED",CHANNEL_NOT_CONFIGURED:"CHANNEL_NOT_CONFIGURED",ENDPOINT_NOT_CONFIGURED:"ENDPOINT_NOT_CONFIGURED",SERVER_ERROR:"SERVER_ERROR"},p=/^[\w.!#$%&'*+/=?^`{|}~-]+@[\w-]+(?:\.[\w-]+)+$/,w=h,I=v(()=>w.apiBase?w.apiBase:(typeof window<"u"?window.__SL_API_BASE__:"").replace(/\/$/,"")),k=n=>`${I.value}${n}`,i=d(!1),_=d(!1),f=d(!1),o=M({message:"",contact:"",pageUrl:"",userAgent:""}),c=d(null),u=d(""),y=d(0),E=v(()=>!o.message.trim()||!o.contact.trim()||!p.test(o.contact.trim())||f.value?!1:Date.now()-y.value>=ne),g=v(()=>c.value?{SUCCESS:"提交成功，感谢反馈",FAILED:"提交失败，请稍后再试",TOO_FREQUENT:"提交过于频繁，请稍后再试",CHANNEL_DISABLED:"渠道未启用",CHANNEL_NOT_CONFIGURED:"渠道未配置",ENDPOINT_NOT_CONFIGURED:"地址未配置",SERVER_ERROR:"服务异常，请稍后再试"}[c.value.status]:""),T=()=>{try{const n=localStorage.getItem(O);if(n){const s=JSON.parse(n);o.message=s.message||"",o.contact=s.contact||""}const t=localStorage.getItem(R);t&&(c.value=JSON.parse(t))}catch(n){console.error("load draft failed",n)}},b=()=>{try{localStorage.setItem(O,JSON.stringify({message:o.message,contact:o.contact}))}catch(n){console.error("save draft failed",n)}},U=async()=>{if(E.value){f.value=!0,u.value="",y.value=Date.now();try{const n={message:o.message.trim(),contact:o.contact.trim(),pageUrl:o.pageUrl||window.location.href,userAgent:o.userAgent||navigator.userAgent},s=await(await fetch(k("/feedback"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json();c.value=s,localStorage.setItem(R,JSON.stringify(s)),s.status!==l.SUCCESS?u.value=g.value:(o.message="",o.contact="",b())}catch{u.value="网络异常，请稍后再试"}finally{f.value=!1}}},L=()=>{i.value=!i.value},z=()=>{_.value=!0},B=()=>{_.value=!1};return A(()=>{T(),console.log("最终API请求地址:",k("/feedback"))}),(n,t)=>(r(),a("div",G,[m(e("div",P,[t[8]||(t[8]=e("div",{class:"popup-header"},[e("div",{class:"header-content"},[e("h3",null,"帮助我们改进"),e("p",null,"您的反馈是我们前进的动力")]),e("div",{class:"circle circle-1"}),e("div",{class:"circle circle-2"})],-1)),e("div",$,[e("div",J,[t[2]||(t[2]=e("label",null,[S(" 反馈内容 "),e("span",{class:"required"},"*")],-1)),m(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.message=s),onInput:b,class:"input-control textarea",rows:"4",placeholder:"请详细描述您遇到的问题或建议..."},null,544),[[N,o.message]])]),e("div",W,[t[4]||(t[4]=e("label",null,[S(" 联系方式 "),e("span",{class:"required"},"*")],-1)),e("div",q,[m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o.contact=s),onInput:b,type:"email",class:"input-control contact-input",placeholder:"您的邮箱地址"},null,544),[[N,o.contact]]),t[3]||(t[3]=e("div",{class:"input-icon"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("rect",{width:"20",height:"16",x:"2",y:"4",rx:"2"}),e("path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"})])],-1))]),o.contact&&!p.test(o.contact)?(r(),a("p",K," 请填写有效的邮箱地址 ")):C("",!0)]),g.value||u.value?(r(),a("div",{key:0,class:x(["status-message",c.value?.status===l.SUCCESS?"status-success":"status-error"])},[e("div",Q,[c.value?.status===l.SUCCESS?(r(),a("svg",Y,[...t[5]||(t[5]=[e("path",{d:"m5 13 4 4L19 7"},null,-1)])])):(r(),a("svg",X,[...t[6]||(t[6]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("line",{x1:"12",x2:"12",y1:"8",y2:"12"},null,-1),e("line",{x1:"12",x2:"12.01",y1:"16",y2:"16"},null,-1)])])),e("span",null,j(g.value||u.value),1)])],2)):C("",!0),e("button",{class:"submit-button",disabled:!E.value,onClick:U},[t[7]||(t[7]=e("div",{class:"button-hover-effect"},null,-1)),f.value?(r(),a("span",ee)):(r(),a("span",te,"提交反馈"))],8,Z)]),t[9]||(t[9]=e("div",{class:"popup-footer"},[e("p",null,"Powered by ServiceLinkLite")],-1))],512),[[F,i.value]]),e("button",{class:"trigger-button",onClick:L,onMouseenter:z,onMouseleave:B,"aria-label":"Toggle feedback form"},[e("div",oe,[(r(),a("svg",{class:x(["icon icon-close",{visible:i.value,hidden:!i.value}]),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[...t[10]||(t[10]=[e("path",{d:"M18 6 6 18"},null,-1),e("path",{d:"m6 6 12 12"},null,-1)])],2)),(r(),a("svg",{class:x(["icon icon-open",{visible:!i.value,hidden:i.value}]),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[...t[11]||(t[11]=[e("path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z"},null,-1)])],2))])],32)]))}}),re=":host{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4}.feedback-widget-container{align-items:flex-end;bottom:24px;display:flex;flex-direction:column;gap:16px;pointer-events:none;position:fixed;right:24px;z-index:9999}.feedback-widget-container>*{pointer-events:auto}.feedback-popup{background:#fff;border:1px solid rgba(15,23,42,.05);border-radius:16px;box-shadow:0 25px 50px -12px #00000040;overflow:hidden;transform-origin:bottom right;width:384px}.swing-in-bottom-fwd{animation:swing-in-bottom-fwd .4s cubic-bezier(.25,.46,.45,.94) both}@keyframes swing-in-bottom-fwd{0%{opacity:0;transform:rotateX(100deg);transform-origin:bottom}to{opacity:1;transform:rotateX(0);transform-origin:bottom}}.popup-header{background:linear-gradient(135deg,#fb923c,#f43f5e,#db2777);color:#fff;overflow:hidden;padding:24px;position:relative}.header-content{position:relative;z-index:10}.header-content h3{font-size:1.125rem;font-weight:600;letter-spacing:.025em;margin:0}.header-content p{font-size:.875rem;margin-bottom:0;margin-top:4px;opacity:.9}.circle{border-radius:50%;filter:blur(24px);position:absolute}.circle-1{background-color:#fde0474d;right:-24px;top:-24px}.circle-1,.circle-2{height:96px;width:96px}.circle-2{background-color:#fff3;bottom:-24px;left:-24px}.popup-body{padding:24px}.form-group{margin-bottom:20px}.form-group label{color:#334155;display:block;font-size:.875rem;font-weight:500;margin-bottom:6px}.required{color:#f43f5e}.input-control{background-color:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;box-sizing:border-box;color:#0f172a;font-size:.875rem;padding:12px 16px;transition:all .2s;width:100%}.input-control::-moz-placeholder{color:#94a3b8}.input-control::placeholder{color:#94a3b8}.input-control:focus{background-color:#fff;border-color:#f43f5e;box-shadow:0 0 0 1px #f43f5e;outline:none}.textarea{resize:none}.input-wrapper{position:relative}.contact-input{padding-left:44px}.input-icon{align-items:center;bottom:0;color:#94a3b8;display:flex;left:0;padding-left:14px;pointer-events:none;position:absolute;top:0}.error-text{color:#f43f5e;font-size:.75rem;margin-top:4px}.status-message{border-radius:8px;font-size:.875rem;margin-bottom:20px;padding:12px}.status-success{background-color:#f0fdf4;color:#15803d}.status-error{background-color:#fef2f2;color:#b91c1c}.status-content,.submit-button{align-items:center;display:flex;gap:8px}.submit-button{background:linear-gradient(90deg,#f97316,#e11d48);border:none;border-radius:12px;box-shadow:0 10px 15px -3px #e11d4840;color:#fff;cursor:pointer;font-size:.875rem;font-weight:700;justify-content:center;overflow:hidden;padding:12px 16px;position:relative;transition:all .3s;width:100%}.submit-button:hover{box-shadow:0 10px 15px -3px #e11d4866}.submit-button:disabled{box-shadow:none;cursor:not-allowed;opacity:.5}.button-hover-effect{background-color:#fff3;inset:0;opacity:0;position:absolute;transition:opacity .3s}.submit-button:hover .button-hover-effect{opacity:1}.spinner{animation:spin 1s linear infinite;border:2px solid #fff;border-radius:50%;border-top-color:transparent;height:20px;width:20px}@keyframes spin{to{transform:rotate(1turn)}}.popup-footer{background-color:#f8fafc80;border-top:1px solid #f1f5f9;padding:12px;text-align:center}.popup-footer p{color:#94a3b8;font-size:10px;font-weight:500;margin:0}.trigger-button{align-items:center;background:linear-gradient(135deg,#fb923c,#e11d48);border:none;border-radius:50%;box-shadow:0 10px 15px -3px #e11d484d;color:#fff;cursor:pointer;display:flex;height:56px;justify-content:center;transition:all .3s;width:56px}.trigger-button:hover{box-shadow:0 20px 25px -5px #e11d4866;transform:translateY(-4px)}.trigger-button:active{transform:scale(.95)}.icon-wrapper{height:50px;position:relative;width:50px}.icon{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);transition:all .3s}.combined-enter-active,.combined-leave-active{transition:opacity .3s ease}.icon.visible{opacity:1;transform:translate(-50%,-50%) rotate(0)}.icon.hidden{opacity:0;transform:translate(-50%,-50%) rotate(90deg)}.icon-close.hidden{transform:translate(-50%,-50%) rotate(-90deg)}",ae=Object.assign(H(se,[["styles",[re]]]),{__name:"FeedbackWidgetCe"}),ie={class:"p-8"},ce=D({__name:"test",setup(h){return A(()=>{if(!customElements.get("feedback-widget-demo")){const l=V(ae);customElements.define("feedback-widget-demo",l)}}),(l,p)=>(r(),a("div",ie,[...p[0]||(p[0]=[e("h1",{class:"text-2xl font-bold mb-4"},"Web Component 测试3",-1),e("p",null,"组件应该显示在右下角。",-1),e("feedback-widget-demo",null,null,-1)])]))}});export{ce as default};
