import{d as T,o as q,x as l,y as a,z as e,D as g,A as c,M as R,L as p,I as x,P as _,K as h,B as U,C as D,T as E,k as C,g as r,N as j,q as W,_ as $,Q as z}from"./BKyL1kJz.js";const A={class:"min-h-screen bg-slate-50 py-10"},I={class:"mx-auto max-w-5xl space-y-6 px-4 sm:px-6 lg:px-0"},P={class:"flex flex-col gap-3 rounded-2xl border border-blue-100 bg-gradient-to-r from-blue-50 via-slate-50 to-indigo-50 p-6 shadow-sm"},K={class:"flex flex-wrap items-center justify-between gap-3"},Q={class:"flex flex-wrap items-center gap-2 text-sm text-slate-700"},Z={class:"inline-flex items-center gap-2 rounded-full border border-blue-100 bg-white/80 px-3 py-1 shadow-sm"},F={class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},G={key:0,d:"m5 13 4 4L19 7"},H={key:1,d:"M18 6 6 18M6 6l12 12"},X={key:0,class:"flex flex-wrap gap-2 text-sm"},Y={key:0,class:"flex items-center gap-2 rounded-md border border-red-100 bg-red-50 px-3 py-2 text-red-700"},ee={key:1,class:"flex items-center gap-2 rounded-md border border-blue-100 bg-blue-50 px-3 py-2 text-blue-700"},te={class:"grid gap-6 lg:grid-cols-3"},se={class:"space-y-6 lg:col-span-2"},oe={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},le={class:"flex items-center justify-between"},ne={class:"inline-flex cursor-pointer select-none items-center gap-2 text-sm font-medium text-slate-700"},ae={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm space-y-5"},ie={class:"space-y-4"},re={class:"space-y-1"},de={class:"space-y-1"},ue={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm space-y-4"},ce={class:"flex items-center justify-between"},pe={class:"inline-flex cursor-pointer select-none items-center gap-2 text-sm font-medium text-slate-700"},xe={class:"space-y-4"},be={class:"space-y-2"},me={class:"flex items-center gap-3"},fe={class:"space-y-2"},ge={class:"flex items-center gap-3"},ve=["value"],we={class:"space-y-4"},he={class:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm space-y-3"},ye=["disabled"],ke={key:0,class:"h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},_e={key:1},Ce={key:2},je=["disabled"],Te={key:0,class:"fixed top-6 right-6 flex items-center gap-2 rounded-lg bg-white px-4 py-3 text-sm font-medium text-green-700 shadow-lg ring-1 ring-green-100 backdrop-blur-sm bg-white/80",style:{"z-index":"9999"}},Be=T({__name:"config",setup(B){const y=W(),v=C(()=>{const o=y.public?.apiBase,t=typeof window<"u"?window.__SL_API_BASE__:"";return(o||t||"/api").replace(/\/$/,"")}),k=o=>`${v.value}${o}`,d=r(!1),u=r(!1),n=r(""),S=r(""),b=r(""),w=r(!1),m=r(null),M=o=>{b.value=o,w.value=!0,m.value&&clearTimeout(m.value),m.value=window.setTimeout(()=>{w.value=!1,b.value="",m.value=null},2800)},s=j({enabled:!0,dingTalk:{webhook:"",secret:""},rateLimit:{enabled:!0,maxRequests:10}}),f=j({enabled:!0,dingTalk:{webhook:"",secret:""},rateLimit:{enabled:!0,maxRequests:10}}),O=C(()=>JSON.stringify(s)!==JSON.stringify(f)),L=()=>(n.value="",s.dingTalk.webhook.trim()?s.rateLimit.maxRequests<=0?(n.value="频控阈值需为正整数",!1):!0:(n.value="钉钉 webhook 必填",!1)),N=async()=>{d.value=!0,n.value="";try{const o=await fetch(k("/config"));if(!o.ok)throw new Error("load config failed");const t=await o.json();Object.assign(s,t),Object.assign(f,JSON.parse(JSON.stringify(t)))}catch{n.value="加载配置失败，请稍后再试"}finally{d.value=!1}},V=()=>{Object.assign(s,JSON.parse(JSON.stringify(f))),n.value=""},J=async()=>{if(L()){u.value=!0,n.value="";try{const o=await fetch(k("/config"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok)throw new Error("save failed");const t=await o.json();Object.assign(f,JSON.parse(JSON.stringify(t))),M("保存成功")}catch{n.value="保存失败，请稍后再试"}finally{u.value=!1}}};return q(()=>{N()}),(o,t)=>(l(),a("div",A,[e("div",I,[e("div",P,[e("div",K,[t[6]||(t[6]=e("div",null,[e("h1",{class:"text-2xl font-semibold text-slate-900"},"服务配置12"),e("p",{class:"text-sm text-slate-600"},"配置反馈通道与频控策略，实时生效")],-1)),e("div",Q,[e("span",Z,[t[5]||(t[5]=e("svg",{class:"h-4 w-4 text-blue-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M3 5h18"}),e("path",{d:"M7 12h10"}),e("path",{d:"M5 19h14"})],-1)),g(" 接口基址："+c(v.value),1)]),e("span",{class:R(["inline-flex items-center gap-2 rounded-full px-3 py-1 text-white shadow-sm",s.enabled?"bg-green-500":"bg-slate-400"])},[(l(),a("svg",F,[s.enabled?(l(),a("path",G)):(l(),a("path",H))])),g(" "+c(s.enabled?"反馈已启用":"反馈未启用"),1)],2)])]),n.value||S.value||d.value?(l(),a("div",X,[n.value?(l(),a("div",Y,[t[7]||(t[7]=e("svg",{class:"h-4 w-4 text-red-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M12 9v4m0 4h.01"}),e("path",{d:"M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.7 3.86a2 2 0 0 0-3.42 0Z"})],-1)),e("span",null,c(n.value),1)])):p("",!0),d.value?(l(),a("div",ee,[...t[8]||(t[8]=[e("svg",{class:"h-4 w-4 animate-spin text-blue-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})],-1),e("span",null,"加载中...",-1)])])):p("",!0)])):p("",!0)]),e("div",te,[e("div",se,[e("div",oe,[e("div",le,[t[9]||(t[9]=e("div",null,[e("p",{class:"text-sm font-semibold text-slate-900"},"反馈开关"),e("p",{class:"text-sm text-slate-600"},"总开关控制是否对外提供反馈能力")],-1)),e("label",ne,[x(e("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=i=>s.enabled=i),class:"h-4 w-4"},null,512),[[_,s.enabled]]),g(" "+c(s.enabled?"已启用":"未启用"),1)])])]),e("div",ae,[t[14]||(t[14]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("p",{class:"text-lg font-semibold text-slate-900"},"钉钉配置"),e("p",{class:"text-sm text-slate-600"},"Webhook 必填，Secret 可空（仅在启用签名时使用）")]),e("span",{class:"rounded-full border border-blue-100 bg-blue-50 px-3 py-1 text-xs font-medium text-blue-700"},"必填：Webhook")],-1)),e("div",ie,[e("div",re,[t[10]||(t[10]=e("label",{class:"text-sm font-medium text-slate-800"},"Webhook *",-1)),x(e("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>s.dingTalk.webhook=i),class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-900 placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring focus:ring-blue-200 transition-colors",placeholder:"https://oapi.dingtalk.com/robot/send?access_token=..."},null,512),[[h,s.dingTalk.webhook]]),t[11]||(t[11]=e("p",{class:"text-xs text-slate-500"},"使用钉钉机器人提供的完整 webhook 地址",-1))]),e("div",de,[t[12]||(t[12]=e("label",{class:"text-sm font-medium text-slate-800"},"Secret (可选)",-1)),x(e("input",{"onUpdate:modelValue":t[2]||(t[2]=i=>s.dingTalk.secret=i),class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-900 placeholder-slate-400 focus:border-blue-500 focus:outline-none focus:ring focus:ring-blue-200 transition-colors",placeholder:"未启用签名可留空"},null,512),[[h,s.dingTalk.secret]]),t[13]||(t[13]=e("p",{class:"text-xs text-slate-500"},"开启签名校验时填写密钥，否则可留空",-1))])])]),e("div",ue,[e("div",ce,[t[15]||(t[15]=e("div",null,[e("p",{class:"text-lg font-semibold text-slate-900"},"频控"),e("p",{class:"text-sm text-slate-600"},"防止滥用，在时间窗口内限制最大请求数")],-1)),e("label",pe,[x(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=i=>s.rateLimit.enabled=i),class:"h-4 w-4"},null,512),[[_,s.rateLimit.enabled]]),g(" "+c(s.rateLimit.enabled?"已启用":"未启用"),1)])]),e("div",xe,[e("div",be,[t[17]||(t[17]=e("label",{class:"text-sm font-medium text-slate-800"},"时间窗口内最大请求数 *",-1)),e("div",me,[x(e("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=i=>s.rateLimit.maxRequests=i),class:"w-44 rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-900 focus:border-blue-500 focus:outline-none focus:ring focus:ring-blue-200 transition-colors",min:"1"},null,512),[[h,s.rateLimit.maxRequests,void 0,{number:!0}]]),t[16]||(t[16]=e("span",{class:"text-xs text-slate-500"},"需为正整数",-1))])]),e("div",fe,[t[19]||(t[19]=e("label",{class:"text-sm font-medium text-slate-800"},"时间窗口（分钟）",-1)),e("div",ge,[e("input",{type:"number",value:s.rateLimit.windowMinutes,class:"w-44 rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-900 focus:border-blue-500 focus:outline-none focus:ring focus:ring-blue-200 transition-colors bg-slate-100",readonly:""},null,8,ve),t[18]||(t[18]=e("span",{class:"text-xs text-slate-500"},"只读，不可修改",-1))])])])])]),e("div",we,[e("div",he,[t[21]||(t[21]=e("p",{class:"text-sm font-semibold text-slate-900"},"操作",-1)),e("button",{class:"flex w-full items-center justify-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-blue-700 focus:outline-none focus:ring focus:ring-blue-200 disabled:cursor-not-allowed disabled:opacity-50",disabled:u.value||d.value||!O.value,onClick:J},[u.value?(l(),a("svg",ke,[...t[20]||(t[20]=[e("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"},null,-1)])])):p("",!0),u.value?(l(),a("span",_e,"保存中...")):(l(),a("span",Ce,"保存配置"))],8,ye),e("button",{class:"w-full rounded-lg border border-slate-200 px-4 py-2 text-sm font-medium text-slate-700 transition-colors hover:bg-slate-50 focus:outline-none focus:ring focus:ring-slate-200 disabled:cursor-not-allowed disabled:opacity-60",disabled:u.value||d.value,onClick:V}," 重置为服务器值 ",8,je),t[22]||(t[22]=e("p",{class:"text-xs text-slate-500"},"仅当有改动时可保存，保存后以服务器返回值为准。",-1))]),t[23]||(t[23]=e("div",{class:"rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-5 text-sm text-slate-700"},[e("p",{class:"font-semibold text-slate-900"},"提示"),e("ul",{class:"mt-2 list-disc space-y-1 pl-4"},[e("li",null,"Webhook 必填且需为钉钉机器人地址。"),e("li",null,"Secret 可留空，启用签名校验时填写机器人提供的密钥。"),e("li",null,"频控阈值需为正整数，关闭频控以允许无限制访问。")])],-1))])])]),U(E,{name:"toast-fade"},{default:D(()=>[w.value&&b.value?(l(),a("div",Te,[t[24]||(t[24]=e("svg",{class:"h-4 w-4 text-green-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"m5 13 4 4L19 7"})],-1)),e("span",null,c(b.value),1)])):p("",!0)]),_:1})]))}}),Se=Object.assign($(Be,[["__scopeId","data-v-307c8c95"]]),{__name:"Config"}),Oe=T({__name:"index",setup(B){return(y,v)=>(l(),z(Se))}});export{Oe as default};
